# Excel複数ファイル データ抽出・転記システム 要件定義書（最終版）

## 1. システム概要

### 1.1 システム名
Excel複数ファイル データ抽出・転記システム

### 1.2 システムの目的
同一フォーマットの複数Excelファイル（最大200枚）から指定したセルの値を自動抽出し、1つのファイルに転記・集約することで、データ収集作業の効率化と人的ミスの削減を実現する。

### 1.3 システムの特徴
- **簡単操作**：ボタン1つで実行可能
- **柔軟な設定**：TENKI番号による自由なセル指定
- **エラー対策**：詳細なエラーログとプレビュー機能
- **見やすい出力**：自動整形された結果シート

### 1.4 対象ユーザー
- Excelの基本操作ができる一般事務職員
- ITスキルレベル：初級～中級

## 2. システム構成

### 2.1 必要環境
- Microsoft Excel 2016以降
- Windows OS（Windows 10以降推奨）
- VBAマクロが実行可能な環境

### 2.2 ファイル構成
```
転記システム.xlsm
├── フォーマットシート（転記元レイアウト定義）
├── マスタシート（処理対象ファイルリスト）
├── 設定シート（システム設定・非表示）
└── VBAモジュール（Module1）
```

## 3. 機能要件

### 3.1 基本機能

#### 3.1.1 データ抽出機能
- **入力**：同一フォーマットのExcelファイル（0～200個）
- **処理**：TENKI番号で指定されたセルの値を抽出
- **出力**：1ファイル1行の形式で集約

#### 3.1.2 セル指定機能
- フォーマットシートにTENKI番号（TENKI01～TENKI99）を配置
- 飛び番号対応（連続している必要なし）
- 結合セル対応

#### 3.1.3 ファイル管理機能
- マスタシートでファイルリストを管理
- 絶対パス・相対パス両対応
- ファイル存在チェック

### 3.2 ユーザビリティ機能

#### 3.2.1 プレビュー機能
- 実行前にサンプルデータを表示
- 転記内容の事前確認が可能

#### 3.2.2 進捗表示機能
- 処理状況をリアルタイム表示
- 残り時間の予測表示
- パーセンテージ表示

#### 3.2.3 エラーハンドリング
- エラーログの自動生成
- エラー別シート出力
- 処理継続/中断の選択

### 3.3 出力機能

#### 3.3.1 結果シート生成
- 自動命名（転記結果_YYYYMMDD_HHMMSS）
- ヘッダー行の自動生成
- データ開始行：3行目

#### 3.3.2 自動整形機能
- ヘッダー行の色分け
- データ行の縞模様
- 罫線の自動設定
- 列幅の自動調整
- ウィンドウ枠の固定

#### 3.3.3 サマリー機能
- 処理日時
- 処理時間
- 処理ファイル数
- エラー数

## 4. 処理フロー

```
1. 前提条件チェック
   ├── フォーマットシート存在確認
   └── マスタシート存在確認

2. プレビュー表示（オプション）
   ├── 対象ファイル数表示
   ├── 転記セル数表示
   └── サンプルデータ表示

3. メイン処理
   ├── ファイルリスト取得
   ├── 転記セル情報取得
   ├── 結果シート作成
   └── データ転記処理（ループ）
       ├── ファイルオープン
       ├── データ抽出
       ├── 結果シートへ転記
       └── ファイルクローズ

4. 後処理
   ├── 結果シート整形
   ├── サマリー追加
   ├── エラーログ出力（必要時）
   └── 設定保存
```

## 5. エラー処理

### 5.1 エラーの種類
1. **ファイルエラー**
   - ファイルが見つからない
   - ファイルが開けない
   - アクセス権限なし

2. **データエラー**
   - セル参照エラー
   - データ型不一致

3. **システムエラー**
   - メモリ不足
   - その他の実行時エラー

### 5.2 エラー対応
- エラー内容を記録
- 処理を継続
- 最後にエラーログを出力

## 6. パフォーマンス

### 6.1 処理速度の目安
- 50ファイル：約2-3分
- 100ファイル：約5分
- 200ファイル：約10分

### 6.2 最適化の工夫
- 画面更新の抑制
- 必要最小限のファイルアクセス
- 効率的なメモリ使用

## 7. セキュリティ

### 7.1 マクロセキュリティ
- 信頼できる場所からの実行を推奨
- マクロ有効化の必要性

### 7.2 データ保護
- 読み取り専用でファイルを開く
- 元ファイルは変更しない

## 8. 制限事項

### 8.1 機能制限
- 転記元ファイルは同一フォーマット必須
- 最大処理ファイル数：200
- 画像・グラフは転記対象外

### 8.2 環境制限
- Excel VBA実行環境必須
- Windows環境推奨

## 9. 保守・運用

### 9.1 日常運用
- 定期的なバックアップ推奨
- エラーログの定期確認

### 9.2 トラブルシューティング
- エラーログの活用
- マスタ・フォーマットシートの確認
- VBAデバッグ機能の活用

## 10. 今後の拡張可能性

### 10.1 機能拡張案
- 複数シート対応
- 条件付き転記
- CSV出力機能
- 差分比較機能

### 10.2 連携可能性
- Power Automate連携
- データベース連携
- Web API連携